<!DOCTYPE html>
<html lang="fr">
<head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="../assets/CSS/style.css">
    <link rel="stylesheet" type="text/css" href="../assets/CSS/classement.css">
    <title>Classements FootIQ</title>

    </head>
    <body>

        <nav class="navbar navbar-expand-lg">
                <div class="container-fluid">
                    <a class="navbar-brand" href="../index.html">
                        <img class= "logo" src="../assets/IMG/Logo.png" alt="Logo" width="100" height="100" class="d-inline-block align-text-center">
                    </a>
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                        <li class="nav-item">
                        <a class="nav-link" aria-current="page" href="../index.html">Accueil</a>
                        </li>
                        <li class="nav-item">
                        <a class="nav-link" href="../Match/match.hmtl">Match</a>
                        </li>
                        <li class="nav-item">
                        <a class="nav-link" href="../Championnat/championnat.html">Championnat</a>
                        </li>
                        <li class="nav-item">
                        <a class="nav-link active" href="classment.html">Classement</a>
                        </li>
                        <li class="nav-item">
                        <a class="nav-link" href="#">Mon Compte</a>
                        </li>
                    </ul>
                    <form class="d-flex" role="search" method="GET" action="../php/recherche.php">
                        <input class="form-control me-2" type="search" placeholder="Recherche" aria-label="Search" name="query" />
                        <button class="btn btn-outline-success" type="submit">Recherche</button>
                    </form>
                </div>
            </div>
        </nav>

        <div id="box">

            <h1>Classements des championnats</h1>

            <div class="top-bar">
                <div id="championnat-name" class="champ-name">Sélectionnez un championnat</div>

                <div class="search-container">
                    <input type="text" id="search-input" class="form-control" placeholder="Rechercher un championnat...">

                    <button 
                        type="button" 
                        class="btn-close" 
                        id="clear-search"
                        aria-label="Clear">
                    </button>

                    <ul id="search-results" class="results-list"></ul>
                </div>
            </div>

            <table id="classement-table" style="display:none; margin-top:15px;" border="1">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Équipe</th>
                        <th>M</th>
                        <th>V</th>
                        <th>N</th>
                        <th>D</th>
                        <th>BP</th>
                        <th>BC</th>
                        <th>Diff</th>
                        <th>Pts</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>

        </div>




        <script>
            const URL_CLASSEMENT = "https://raw.githubusercontent.com/NathanSvbin/FootIQ/main/Classement/classements.json";
            const URL_PAYS = "pays.json";

            let allChampionats = [];
            let allPays = [];

            // Charger les championnats et les pays
            Promise.all([
                fetch(URL_CLASSEMENT).then(r => r.json()),
                fetch(URL_PAYS).then(r => r.json())
            ]).then(([champs, pays]) => {

                // ---- ADAPTATION phpMyAdmin ----
                // pays.json = [header, database, { table + data }]
                if (Array.isArray(pays) && pays[2] && pays[2].data) {
                    allPays = pays[2].data.map(p => ({
                        Id: parseInt(p.Id, 10),
                        Nom: p.Nom.trim()
                    }));
                } else {
                    allPays = pays.map(p => ({
                        Id: parseInt(p.Id, 10),
                        Nom: p.Nom.trim()
                    }));
                }

                // Normaliser les championnats
                allChampionats = champs.map(c => ({
                    ...c,
                    id_championnat: parseInt(c.id_championnat, 10),
                    id_pays: parseInt(c.id_pays, 10)
                }));
            });

            // Références DOM
            const searchInput = document.getElementById("search-input");
            const resultsList = document.getElementById("search-results");
            const table = document.getElementById("classement-table");
            const tbody = table.querySelector("tbody");
            const champName = document.getElementById("championnat-name");

            // Fonction pour trouver le nom du pays par ID
            function getPaysNom(id_pays) {
                const pData = allPays.find(p => p.Id === id_pays);
                return pData ? pData.Nom : "Pays inconnu";
            }

            // Filtrage dynamique
            searchInput.addEventListener("input", () => {
                const query = searchInput.value.trim().toLowerCase();
                resultsList.innerHTML = "";

                if (!query) {
                    resultsList.style.display = "none";
                    return;
                }

                const filtered = allChampionats.filter(c =>
                    c.championnat.toLowerCase().includes(query)
                );

                filtered.forEach(c => {
                    const paysNom = getPaysNom(c.id_pays);

                    const li = document.createElement("li");
                    li.textContent = `${c.championnat} (${paysNom})`;
                    li.dataset.id = c.id_championnat;
                    li.style.cursor = "pointer";
                    resultsList.appendChild(li);
                });

                resultsList.style.display = filtered.length > 0 ? "block" : "none";
            });

            // Sélection d’un championnat
            resultsList.addEventListener("click", (e) => {
                const target = e.target;
                if (target.tagName !== "LI") return;

                const id = target.dataset.id;
                searchInput.value = target.textContent;
                resultsList.style.display = "none";

                afficherChampionnat(id);
            });

            // Affichage du classement
            function afficherChampionnat(id) {
                tbody.innerHTML = "";

                const cData = allChampionats.find(c => c.id_championnat === parseInt(id, 10));
                if (!cData) {
                    champName.textContent = "Championnat introuvable";
                    table.style.display = "none";
                    return;
                }

                const paysNom = getPaysNom(cData.id_pays);
                champName.textContent = `${cData.championnat} (${paysNom})`;

                if (!cData.equipes || cData.equipes.length === 0) {
                    tbody.innerHTML = `<tr><td colspan="10" style="text-align:center;">Aucune équipe disponible</td></tr>`;
                } else {
                    cData.equipes.forEach(eq => {
                        const tr = document.createElement("tr");
                        tr.innerHTML = `
                            <td>${eq.position}</td>
                            <td>${eq.nom}</td>
                            <td>${eq.matchs}</td>
                            <td>${eq.victoires}</td>
                            <td>${eq.nuls}</td>
                            <td>${eq.defaites}</td>
                            <td>${eq.buts_pour}</td>
                            <td>${eq.buts_contre}</td>
                            <td>${eq.difference}</td>
                            <td>${eq.points}</td>
                        `;
                        tbody.appendChild(tr);
                    });
                }

                table.style.display = "table";
            }
        </script>
        <script>
            // Bouton reset & loupe
            const clearBtn = document.getElementById("clear-search");
            const searchIcon = document.getElementById("search-icon");

            // Montrer / cacher la croix
            searchInput.addEventListener("input", () => {
                if (searchInput.value.trim() !== "") {
                    clearBtn.style.display = "block";
                } else {
                    clearBtn.style.display = "none";
                }
            });

            // Effacer la recherche
            clearBtn.addEventListener("click", () => {
                searchInput.value = "";
                clearBtn.style.display = "none";
                resultsList.style.display = "none";

                // Cache le tableau
                table.style.display = "none";
            });

            // Clique sur la loupe = déclenche la recherche
            searchIcon.addEventListener("click", () => {
                searchInput.dispatchEvent(new Event("input"));
            });

        </script>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>       

    </body>
</html>
